{% extends "base.html" %}
{% block content %}

<!-- 
main hero section for the user's booking history page.
Uses Bootstrap flexbox utilities to center the card vertically and horisontally.
`hero-banner hero-tall2` provides consistent background styling across the site.
-->
<main class="d-flex align-items-center justify-content-center py-5 hero-banner hero-tall2" style="min-height: 100vh;">
  <div class="container">
    
    <!--card container for displaying bookings -->
    <!-- may edit this later-->
    <!-- 'shadow-sm' adds subtle depth, and white text ensures readability over dark backgrounds -->
    <div class="card shadow-sm shell-card" style="color:white;">
      <div class="card-body p-4">
        
        <!--page title -->
        <h2 class="text-center mb-4">My Bookings</h2>

          {% if bookings %}
            <!-- Grid wrapper: 1 col on mobile, 2 on md, 3 on lg -->
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 bookings-grid">

              {% for booking in bookings %}
              <div class="col">
                <!-- Single booking card -->
                <div class="card booking-card card--glass card-lift h-100 border-0 rounded-3 overflow-hidden text-white">


                  <!-- Thumbnail + date pill (reuses your event styles) -->
                  <div class="position-relative">
                    <img
                      class="booking-thumb"
                      src="{% if booking.event.image_file %}{{ url_for('static', filename='uploads/' ~ booking.event.image_file) }}{% else %}{{ url_for('static', filename='img/placeholder-event.jpg') }}{% endif %}"
                      alt="{{ booking.event.title }}"
                    >
                    <div class="date-pill">
                      <span class="month">{{ booking.event.date.strftime('%b') }}</span>
                      <span class="day">{{ booking.event.date.strftime('%d') }}</span>
                    </div>
                  </div>

                  <!-- Card body -->
                  <div class="card-body">
                    <!-- Title + small status badge (event status) -->
                    <div class="d-flex justify-content-between align-items-start">
                      <h5 class="card-title mb-1">{{ booking.event.title }}</h5>
                      {% set s = (booking.event.status or '').lower() %}
                      <span class="badge
                        {% if s == 'open' %}bg-success
                        {% elif s in ['closed','cancelled','canceled'] %}bg-secondary
                        {% elif s in ['full','sold out'] %}bg-danger
                        {% else %}bg-info
                        {% endif %}">
                        {{ booking.event.status or 'Status' }}
                      </span>
                    </div>

                    <!-- Short muted subtitle/description -->
                    {% if booking.event.description %}
                      <p class="card-subtext">
                        {{ booking.event.description[:90] }}{% if booking.event.description|length > 90 %}…{% endif %}
                      </p>
                    {% endif %}

                    <!-- Compact "receipt" panel with icons -->
                    <div class="booking-receipt">
                      <div class="receipt-row">
                        <span class="label"><i class="bi bi-calendar-event"></i> Date</span>
                        <span class="value">{{ booking.event.date.strftime('%Y-%m-%d') }}</span>
                      </div>
                      <div class="receipt-row">
                        <span class="label"><i class="bi bi-ticket-perforated"></i> Tickets</span>
                        <span class="value">{{ booking.quantity }}</span>
                      </div>
                      <div class="receipt-row">
                        <span class="label"><i class="bi bi-cash-coin"></i> Total</span>
                        <span class="value price">${{ "%.2f"|format(booking.price) }}</span>
                      </div>
                      <div class="receipt-row">
                        <span class="label"><i class="bi bi-clock-history"></i> Booked</span>
                        <span class="value">{{ booking.date.strftime('%Y-%m-%d') }}</span>
                      </div>
                    </div>

                    <!-- Optional chips for quick context -->
                    <div class="chips mt-2">
                      {% if booking.event.location %}<span class="chip"><i class="bi bi-geo-alt"></i> {{ booking.event.location }}</span>{% endif %}
                      <span class="chip"><i class="bi bi-people"></i> cap {{ booking.event.capacity }}</span>
                      {% if booking.event.features %}<span class="chip"><i class="bi bi-stars"></i> {{ booking.event.features.split(',')[0].strip() }}</span>{% endif %}
                    </div>
                  </div>

                  <!-- Footer actions -->
                  <div class="card-footer bg-transparent border-0 pt-0 d-flex gap-2">
                    <a href="{{ url_for('events.view_event', event_id=booking.event.id) }}" class="btn btn-light w-100">
                      View Event
                    </a>
                    {# If you implement cancellations, show this conditionally:
                    <form method="POST" action="{{ url_for('events.cancel_booking', booking_id=booking.id) }}" class="w-100">
                      <button class="btn btn-outline-danger w-100" onclick="return confirm('Cancel this booking?')">
                        Cancel
                      </button>
                    </form>
                    #}
                  </div>

                </div>
              </div>
              {% endfor %}
            </div>
          {% else %}
            <!-- Empty state -->
            <div class="text-center mt-3">
              <p class="lead">You haven’t made any bookings yet.</p>
              <a href="{{ url_for('events.list_events') }}" class="btn btn-primary mt-2">Browse Events</a>
            </div>
          {% endif %}

          <!-- Back button -->
          <div class="text-center mt-4">
            <a href="{{ url_for('events.list_events') }}" class="btn btn-secondary">Back to Events</a>
          </div>

      </div> 
    </div>   
  </div>   
</main>        

{% endblock %}
