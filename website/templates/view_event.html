
<!--commented-->

{% extends "base.html" %}
{% block content %}

<!--Main wrapper for the event details page-->
<!--using hero-tall2 to get the good auto size for growing size of events-->
<main class="d-flex align-items-center justify-content-center py-5 hero-banner hero-tall2">
  <div class="container">
    <!--Using that glassy style card for displaying the event-->
    <div class="card shadow-sm" style="color:white;">
      <div class="card-body p-4">
        
        <!--Event details section-->
        <!--These values come from the event object passed in from the Flask route-->
        <h2>{{ event.title }}</h2>
        <p>{{ event.description }}</p>
        <!--Event details section extended-->
        <!-- added alot more details as before it was kinda empty-->
        <p><strong>Date:</strong> {{ event.date.strftime('%Y-%m-%d') }}</p>
        <p><strong>Location:</strong> {{ event.location }}</p>
        <p><strong>Status:</strong> {{ event.status }}</p>
        <p><strong>Cost:</strong> ${{ "%.2f"|format(event.cost) }}</p>
        <p><strong>Capacity:</strong> {{ event.capacity }}</p>
        <p><strong>Features:</strong> {{ event.features }}</p>
        
        <!-- changing it from id to name-->
        <p><strong>Created By:</strong>
          {% if event.creator %}
            {{ event.creator.name }}
          {% else %}
            Unknown
          {% endif %}
        </p>
        
        <p><strong>Tickets Left:</strong> {{ tickets_left }}</p>
       
          
        </p>
       

        <!--Only show the event image if one was uploaded-->
        {% if event.image_file %}
          <img src="{{ url_for('static', filename='uploads/' ~ event.image_file) }}" 
               alt="{{ event.title }}" class="img-fluid mb-3">
        <!-- now shows default image if one wasn't uploaded hope this works-->
        {% else %}
            <img src="{{ url_for('static', filename='uploads/default.jpg') }}" class="card-img-top" alt="{{ event.title }}">
        {% endif %}

        <hr>
        <!--only show edit button if the logged-in user is the event owner -->
        {% if current_user.is_authenticated and event.created_by == current_user.id %}
          <div class="text-center mb-4">
            <!--edit Event Button -->
            <a href="{{ url_for('events.edit_event', event_id=event.id) }}" class="btn btn-primary">
              Edit Event
            </a>
                    
        {% endif %}

        <hr>
        <!-- NEW CODE 03/10/25 -->
        <!-- BOOKING FORM -->
        <!-- check if used is logged in, only loggedin users can book tickets-->
        {% if current_user.is_authenticated %}
        <!--if the logged in user is also the creator of the event they can't book-->
        {% if event.created_by == current_user.id %}
          <div class="alert alert-warning mt-3">
            You created this event, so you can't book tickets for it.
          </div>

        <!--if there are no tickets left then its sold out-->
        {% elif tickets_left <= 0 %}
          <div class="alert alert-danger mt-3">
            This event is <strong>SOLD OUT</strong>. No tickets available.
          </div>
        {% else %}

        <!--otherwise we show the booking form-->
          <h4>Book Tickets</h4>
          <form method="POST" action="{{ url_for('events.book_event', event_id=event.id) }}">
            <!--CSRF protection token hidden field -->
            {{ booking_form.hidden_tag() }}

            <!--input field for number of tickets -->
            <div class="mb-3">
              {{ booking_form.quantity.label(class="form-label") }} <!--label for ticket quantity -->
              {{ booking_form.quantity(class="form-control") }} <!--input box for ticket quantity -->

              <!--loop through and display any validation errors for the quantity field -->
              {% for error in booking_form.quantity.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>

            <!--submit button styled with Bootstrap -->
            {{ booking_form.submit(class="btn btn-primary") }}
          </form>
          <!--display how many tickets are still available -->
          <p class="mt-2 h5">Tickets left: {{ tickets_left }}</p>
        {% endif %}
      {% else %}
      <!--if the user is not logged in -> semd prompt getting them to log in -->
        <p><a href="{{ url_for('auth.login') }}">Log in</a> to book tickets.</p>
      {% endif %}

      <hr> <!--divider for separating sections -->


        <!--Comment form section-->
        <!--Only display the form if the user is logged in-->
        <!--In templates can’t use decorators. Instead, we conditionally 
        render content based on the user’s authentication status-->
        <!--Jinja2 template syntax-->
        {% if current_user.is_authenticated %}
          <h4>Add a Comment</h4>
          <form method="POST">
            {{ form.hidden_tag() }} <!--csrf token for security-->
            <div class="mb-3">
              {{ form.text.label(class="form-label") }}
              {{ form.text(class="form-control") }}
              <!--display any validation errors for the comment text - theres no validation atm-->
              {% for error in form.text.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>
             <!--the submit button - using bs for now may change it later-->
            {{ form.submit(class="btn btn-primary") }}
          </form>
        {% else %}
         <!--If not logged in, show a message linking to the login page-->
          <p><a href="{{ url_for('auth.login') }}">Log in</a> to write a comment.</p>
        {% endif %}

        <hr>

        <!--display existing comments for this event-->
        <h4>Comments</h4>
        {% if comments %}
          <ul class="list-group">
            {% for comment in comments %}
              <li class="list-group-item bg-transparent text-white border-light">
                <!--show the comment text-->
                <p>{{ comment.text }}</p>
                <!--show author name and timestamp-->
                <small>By {{ comment.author.name }} on {{ comment.date_created.strftime('%Y-%m-%d') }}</small> <!--removed time-->
              </li>
            {% endfor %}
          </ul>
        {% else %}
         <!--If there are no comments-->
         <!--maybe show transparent image here?-->
          <p>No comments yet. Be the first to comment!</p>
        {% endif %}
      </div>
    </div>
  </div>
</main>

{% endblock %}
